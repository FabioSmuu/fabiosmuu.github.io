<div id="fb-root"></div>
<script src="//connect.facebook.net/en_US/all.js"></script>
<script type="text/javascript">
//https://developers.facebook.com/docs/javascript/reference/v7.0
//https://developers.facebook.com/docs/app-events/gamesonfacebook
//https://developers.facebook.com/docs/reference/javascript/FB.AppEvents.LogEvent
//https://developers.facebook.com/docs/games_payments/payments_lite
//https://developers.facebook.com/docs/javascript/reference/FB.ui

FB.init({
	appId            : '3257310224319370',
	autoLogAppEvents : true,
	xfbml            : true,
	version          : 'v7.0'
})


FB.getLoginStatus(conectar, true)

FB.Event.subscribe('auth.login', function(response) {
	alert('Primeira vez do usuario.')
})

FB.Event.subscribe('auth.logout', function(response) {
	//Este evento é acionado quando o aplicativo percebe que não há mais um usuário válido (em outras palavras, ele teve uma sessão, mas não pode mais validar o usuário atual).
	alert('sessaõ quebrada.')
})

function login() {
	FB.login(conectar, {scope:'email'})
}

function conectar(response) {
	if (response.authResponse) {
		FB.api('/me', function(response) {
			document.getElementById('info').innerHTML = 'Olá, ' + response.name + '.'
			document.getElementById('gameoff').style.display = 'none'			
			document.getElementById('gameon').style.display = 'block'
			main(response)
		})
	} else {
		document.getElementById('info').innerHTML = 'Usuario não autenticado'
		document.getElementById('gameoff').style.display = 'block'
		document.getElementById('gameon').style.display = 'none'
	}
}

function comprar() {
	var obj = {
		method: 'pay',
		action: 'purchaseitem',
		product: '0001',
		developer_payload: ''
	}

	FB.ui(obj, function(data) {
		console.log(data)
	})
}

//document.getElementById('pay').onclick = function() {buy()}

function listar() {
	/*FB.api(
		'/' + PURCHASE_TOKEN + '/consume',
		'post',
		{access_token: access_token},
		result => {
			console.log('consuming product', productId, 'with purchase token', purchaseToken)
			console.log('Result:')
			console.log(result)
		}
	)
	
	FB.api(
		'/app/purchases',
		'get',
		{access_token: 'ACCESS_TOKEN'},
		payload => {
			console.log('purchases payload:')
			console.log(payload)
		}
	)*/


	FB.api(
		'/app/products', 
		'get', 
		function(response) {
			for (let x in response.data) {
				console.log(response.data[x])
			}
		}
	)
}

function compartilhar() {
	FB.ui({
		method: 'share',
		href: 'https://developers.facebook.com/docs/'
	}, function(response){
		if (response && !response.error_message) alert('ok')
	})
}

function main() {
	amigos()
}

function amigos() {
	//console.log(FB.gamingservices.friendFinder())
}
</script>

<div id="info"></div>

<div id="gameoff">
	<input id="login" type="button" value="Logar com Facebook" onclick="login()"/>
</div>

<div id="gameon" style="display: none;">
	<input id="comp" type="button" value="Compartilha" onclick="compartilhar()"/>
	<input id="compra" type="button" value="Listar" onclick="listar()"/>
	<input id="pay" type="button" value="R$ 1,00" onclick="comprar()"/>
</div>
